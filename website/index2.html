<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Swiss Transportation System</title>
    <link rel="stylesheet" href="./src/style2.css" />
  </head>
  <body>
    <div class="app">
      <div id="title-container" class="container">
        <h1 id="title">The Swiss Transportation System</h1>
        <div id="day-sky"></div>
        <div id="sun"></div>
        <div id="bridge"></div>
        <div id="mountain-left"></div>
        <div id="mountain-right"></div>
        <div id="cloud1" class="cloud">
          <img src="../assets/title/cloud1.png" alt="Cloud 1" />
        </div>        
        <div id="cloud2" class="cloud">
          <img src="../assets/title/cloud2.png" alt="Cloud 2" />
        </div>
        <div id="cloud3" class="cloud">
          <img src="../assets/title/cloud3.png" alt="Cloud 3" />
        </div>   
        <div id="train">
          <img src="../assets/title/train.png" alt="Train" />
        </div>
        <div id="particle-container"></div>
      </div>

      <div id="title-to-p1-container" class="container"></div>

      <div id="p1-container" class="container container-padding pink-grainy-bg">
        <div class="flex-row flex-100 flex-center">
          <div class="flex-col flex-100 overflow-auto">
            <div class="flex-row flex-100 flex-center">
              <div class="flex-col text-padding-20">
                <p class="light-text medium-text">
                  Welcome aboard! You're about to embark on a fascinating journey through the intricate web of Swiss transportation, a system so well-oiled, it's like the inner workings of a Swiss watch - and just as precise. Picture this: nestled in the heart of Europe, surrounded by majestic mountains and serene lakes, lies a land where trains run like clockwork, buses reach the most remote alpine villages, and even the boats are punctual. Welcome to Switzerland, where getting from A to B is never a hassle, but an experience.
                </p>
              </div>
            </div>

            <div class="flex-row flex-100 flex-center">
              <div class="flex-col text-padding-20">
                <p class="light-text medium-text">
                  Imagine a country where the public transit system is as diverse as its landscapes. The Swiss Federal Railways, with their unrivaled punctuality, are the lifeblood of the system, threading through bustling cities, quaint towns, and pastoral countryside alike. Then there are the iconic yellow PostBuses, bravely navigating through winding mountainous roads, reaching corners of Switzerland that even the Swiss might not know existed. Cities each have their own transportation networks, complete with trams and buses, while boats glide seamlessly across shimmering lakes. And let's not forget the cable cars and funiculars, whisking you up to dizzying heights where the air is crisp, and the views, breathtaking.
                </p>
              </div>
            </div>

            <div class="flex-row flex-100 flex-center">
              <div class="flex-col text-padding-20">
                <p class="light-text medium-text">
                  But the <i>pièce de résistance</i>? It's the integrated ticketing system, a marvel of Swiss efficiency. With just one ticket, you can hop from a train to a bus, onto a boat, and then ascend a mountain in a cable car. It's like having an all-access pass to an amusement park, only this park is an entire country. And overseeing this magical ride is the Swiss Federal Office of Transport, the unsung heroes ensuring your journey is as smooth as Swiss chocolate. So buckle up, it's time to explore the Swiss transportation system, where every journey is a story in itself.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="p1-to-p2-container" class="container"></div>

      <div id="p2-container" class="container container-padding off-white-bg">
        <div class="flex-row flex-100 flex-center">
          <div class="flex-col flex-50 overflow-auto">
            <div class="flex-row flex-center">
              <div class="flex-col text-padding-20">
                <p class="large-text large-font-weight">
                  Mobility Mosaic
                </p>
              </div>
            </div>

            <div class="flex-row flex-center">
              <div class="flex-col text-padding-20">
                <p class="medium-text">
                  Feast your eyes on our first visualization - a circle packing chart, beautifully unravels the Swiss transportation tapestry, showcasing not just the various modes of transport but also their distinctive types.
                </p>
              </div>
            </div>

            <div class="flex-row flex-center">
              <div class="flex-col text-padding-20">
                <p class="medium-text">
                  Picture a universe of circles where each major mode - buses, trains, trams, metros, rack railways, boats - is a solar system in itself, each hosting its own set of planets representing different types within the category.
                </p>
              </div>
            </div>

            <div class="flex-row flex-center">
              <div class="flex-col text-padding-20">
                <p class="medium-text">
                  The train system, for instance, isn't just a single circle, but a constellation of circles representing intercity trains, regional trains, and more.
                </p>
              </div>
            </div>

            <div class="flex-row flex-center">
              <div class="flex-col text-padding-20">
                <p class="medium-text">
                  Through this visualization, we delve deeper into the Swiss transportation universe, revealing the layers and complexities of each mode. It's not just about buses or trains; it's about the intricate network within each mode that together makes Swiss transportation so efficient and comprehensive. This is the beauty of Swiss precision - and our circle packing chart captures it perfectly.
                </p>
              </div>
            </div>
          </div>

          <div class="flex-col flex-50 height-100 overflow-auto">
            <div class="flex-row flex-80">
              <div id="circle-packing-plot"></div>
            </div>
            <div id="circle-packing-text" class="flex-row flex-20 flex-center">
              <p class="medium-text text-padding-10 text-center text-italic width-100">
                Click on each circle to zoom in and explore the different types of transportation.
              </p>
            </div>
          </div>
        </div>
      </div>

      <div id="p2-to-p3-container" class="container ow-to-ow-bg"></div>

      <div id="p3-container" class="container off-white-bg">
        <div class="flex-row flex-100 flex-center">
          <div class="flex-col flex-50 overflow-auto">
            <div class="flex-row flex-center">
              <div class="flex-col text-padding-20">
                <p class="large-text large-font-weight">
                  Swiss Nexus
                </p>
              </div>
            </div>

            <div class="flex-row flex-center">
              <div class="flex-col text-padding-20">
                <p class="medium-text">
                  Behold our second visualization - a mesmerizing hierarchical edge bundling that uncovers the hidden connections between Switzerland's diverse cantons. Picture a miniature map of the country, where each canton is but a click away. With a simple selection, watch as a vibrant, circular layout springs to life, unveiling the transport stops that stitch together the tapestry of Swiss mobility.
                </p>
              </div>
            </div>

            <div class="flex-row flex-center">
              <div class="flex-col text-padding-20">
                <p class="medium-text">
                  This captivating visualization highlights the intricate web of connections that unite different corners of Switzerland, fostering a sense of unity and cohesion. The myriad lines weaving through the circle, much like the threads of an artisan's loom, reveal the true extent of the country's interconnectedness, showcasing the vital role transportation plays in bridging the gaps between its urban hubs and remote hideaways.
                </p>
              </div>
            </div>

            <div class="flex-row flex-center">
              <div class="flex-col text-padding-20">
                <p class="medium-text">
                  Step into the shoes of a modern-day explorer, charting the unseen connections that bring the Swiss landscape to life. Through this visual masterpiece, discover the harmony that exists within the Swiss transportation system, and experience the joy of uncovering the ties that bind this small yet mighty nation together.
                </p>
              </div>
            </div>
          </div>

          <div class="flex-col flex-50 height-100 overflow-auto">
            <div class="flex-row flex-80">
              <div id="hierarchy-plot"></div>
            </div>
            <div class="flex-row flex-20">
              <div id="hierarchy-minimap"></div>
            </div>
          </div>
        </div>
      </div>

      <div id="p3-to-p4-container" class="container ow-to-ow-bg"></div>

      <div id="p4-container" class="container container-padding off-white-bg">
        <div class="flex-row flex-100 flex-center">
          <div class="flex-col flex-50 overflow-auto">
            <div class="flex-row flex-center">
              <div class="flex-col text-padding">
                <p class="medium-text">
                  Yaaaaas slay queen.
                </p>
              </div>
            </div>
          </div>
          <div class="flex-col flex-50">
            <div id="bar-container-plot">
              <div id="buttons"></div>
              <div id="chart"></div>   
            </div>
          </div>
        </div>
      </div>

      <div id="p-to-final-container" class="container"></div>

      <div id="final-container" class="container">
        <div id="maintainers">
          <div id="maintainers-list">
          Website published on the <span id="current_date" itemprop="date">7th of May 2023</span> and maintained by
            <a class="github-link" href="https://github.com/dvculha" target="_blank">Dafne Culha</a>, 
            <a class="github-link" href="https://github.com/ozan-guven" target="_blank">Ozan Güven</a> and 
            <a class="github-link" href="https://github.com/ArnaudPoletto" target="_blank">Arnaud Poletto</a>
          </div>
          <div id="maintainers-github">
            <a class="github-link no-decoration" href="https://github.com/com-480-data-visualization/project-2023-choo-choo-data-darlings/tree/master" target="_blank">Take a look at the project's <i class="bi bi-github"></i> GitHub repository!</a>
          </div>
        </div>
        <div id="night-sky"></div>
        <div id="moon"></div>
        <div id="night-bridge"></div>
        <div id="night-mountain-left"></div>
        <div id="night-mountain-right"></div>
      </div>
    </div>
  </body>

  <script type="module" src="/src/main2.ts"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // PARTICLES
      const particleContainer = document.getElementById("particle-container");
      const train = document.getElementById("train");

      function createParticle(left_shift=0) {
        const particle = document.createElement("div");
        particle.classList.add("particle");
        particle.style.left = train.getBoundingClientRect().left + left_shift + (0.5 - Math.random()) * 5 + "px";
        particleContainer.appendChild(particle);

        setTimeout(() => {
          const randomY = (0.8 - Math.random()) * 20;
          const randomX = (0.5 - Math.random()) * 20 + 20;
          particle.style.opacity = 1;
          particle.style.transform = `translateY(${randomY}vh) translateX(${randomX}vw)`;
          particle.style.transition = `transform 5s ease-out, opacity 2s linear`;
        }, 0);

        setTimeout(() => {
          particle.style.opacity = 0;
        }, 3000);

        setTimeout(() => {
          particleContainer.removeChild(particle);
        }, 5000);
      }

      setInterval(() => {
        const trainRect = train.getBoundingClientRect();
        const bridgeRect = document.getElementById("bridge").getBoundingClientRect();

        if (trainRect.left <= bridgeRect.right && trainRect.right >= bridgeRect.left) {
          createParticle(train.getBoundingClientRect().width);
          createParticle(train.getBoundingClientRect().width / 2);
          createParticle(0);
        }
      }, 100);

      // SCROLLING
      SCROLL_DURATION = 1000;
      function isElementInViewport(el) {
        const rect = el.getBoundingClientRect();
        const windowHeight = (window.innerHeight || document.documentElement.clientHeight);
        const windowWidth = (window.innerWidth || document.documentElement.clientWidth);

        return (
          rect.top >= 0 &&
          rect.left >= 0 &&
          rect.bottom <= (windowHeight + 1) &&  // Allow for rounding errors in Chrome
          rect.right <= (windowWidth + 1)  // Allow for rounding errors in Chrome
      );
      }

      function scrollToElement(element) {
        element.scrollIntoView({
          behavior: "smooth",
        });
      }

      function smoothScrollTo(element, duration) {
        const start = window.pageYOffset;
        const target = element.getBoundingClientRect().top;
        const startTime = performance.now();

        function step(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);

          window.scrollTo({
            top: start + target * easeInOutQuad(progress),
          });

          if (elapsed < duration) {
            window.requestAnimationFrame(step);
          }
        }

        window.requestAnimationFrame(step);
      }

      function easeInOutQuad(t) {
        return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;
      }

      function getScrollDirection(event) {
        return event.deltaY > 0 ? "down" : "up";
      }

      function scrollDown(event) {
        event.preventDefault(); // Disable default scrolling globally

        const titleContainer = document.getElementById("title-container");
        const p1Container = document.getElementById("p1-container");
        const p2Container = document.getElementById("p2-container");
        const p3Container = document.getElementById("p3-container");
        const p4Container = document.getElementById("p4-container");
        const finalContainer = document.getElementById("final-container");
        if (isElementInViewport(titleContainer) && getScrollDirection(event) === "down") {
          event.preventDefault();
          smoothScrollTo(p1Container, SCROLL_DURATION);
        }

        if (isElementInViewport(p1Container) && getScrollDirection(event) === "down") {
          smoothScrollTo(p2Container, SCROLL_DURATION);
        }

        if (isElementInViewport(p2Container) && getScrollDirection(event) === "down") {
          smoothScrollTo(p3Container, SCROLL_DURATION);
        }

        if (isElementInViewport(p3Container) && getScrollDirection(event) === "down") {
          smoothScrollTo(p4Container, SCROLL_DURATION);
        }

        if (isElementInViewport(p4Container) && getScrollDirection(event) === "down") {
          smoothScrollTo(finalContainer, SCROLL_DURATION);
        }

        if (isElementInViewport(finalContainer) && getScrollDirection(event) === "up") {
          smoothScrollTo(p4Container, SCROLL_DURATION);
        }

        if (isElementInViewport(p4Container) && getScrollDirection(event) === "up") {
          smoothScrollTo(p3Container, SCROLL_DURATION);
        }

        if (isElementInViewport(p3Container) && getScrollDirection(event) === "up") {
          smoothScrollTo(p2Container, SCROLL_DURATION);
        }

        if (isElementInViewport(p2Container) && getScrollDirection(event) === "up") {
          smoothScrollTo(p1Container, SCROLL_DURATION);
        }
        
        if (isElementInViewport(p1Container) && getScrollDirection(event) === "up") {
          smoothScrollTo(titleContainer, SCROLL_DURATION);
        }
      }

      document.addEventListener("wheel", scrollDown, { passive: false });
      document.addEventListener("touchmove", scrollDown, { passive: false });

      // Scroll to title on page load
      const titleContainer = document.getElementById("title-container");
      smoothScrollTo(titleContainer, 0);
    });
  </script>
</html>